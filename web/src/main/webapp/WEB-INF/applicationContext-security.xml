<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 2006 - 2010 Under Dusken

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
  had to do some changes
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:security="http://www.springframework.org/schema/security"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
              http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.0.xsd"
       default-autowire="byName">

    <security:http realm="Annonseweb" access-decision-manager-ref="roleHiearchyAccessDecisionManager" access-denied-page="/jsp/admin/accessdenied.jsp">

        <security:anonymous/>
        <security:form-login login-processing-url="/admin/j_spring_security_check" login-page="/jsp/login.jsp"/>
        <security:logout logout-url="/annonseweb_logout"/>
    </security:http>

    <bean id="roleHiarchy" class="org.springframework.security.access.hierarchicalroles.RoleHierarchyImpl">
        <property name="hierarchy">
            <value>
                ROLE_MASKINIST > ROLE_ANNONSEANSVARLIG
                ROLE_ANNONSEANSVARLIG > ROLE_ANSVARLIG_REDAKTØR
                ROLE_ANNONSE > ROLE_JOURNALIST
                ROLE_ANNONSE > ROLE_LAYOUT
                ROLE_ANNONSE > ROLE_FOTOGRAF
                ROLE_ANNONSE > ROLE_ILLUSTRATØR
                ROLE_ANNONSE > ROLE_DATA
                ROLE_ANNONSE > ROLE_ØKONOMI
                ROLE_ANNONSE > ROLE_KORREKTUR
                ROLE_ANNONSE > ROLE_GJENGSJEF
                ROLE_ANNONSE > ROLE_SIVILARBEIDER
                ROLE_ANNONSE > ROLE_DEBATT-_OG_KRONIKKANSVARLIG
                ROLE_ANNONSE > ROLE_OVERSETTER
                ROLE_ANNONSE > ROLE_REPORTASJEREDAKTØR
                ROLE_ANNONSE > ROLE_NYHETSREDAKTØR
                ROLE_ANNONSE > ROLE_KULTURREDAKTØR
            </value>
        </property>
    </bean>

    <!-- An access decision voter that reads ROLE_* configuration settings -->
    <bean id="roleHiearchyVoter" class="org.springframework.security.access.vote.RoleHierarchyVoter">
        <constructor-arg ref="roleHiarchy" />
    </bean>

    <bean id="roleHiearchyAccessDecisionManager" class="org.springframework.security.access.vote.AffirmativeBased">
        <property name="allowIfAllAbstainDecisions" value="false"/>
        <property name="decisionVoters">
            <list>
                <ref local="roleHiearchyVoter"/>
            </list>
        </property>
    </bean>

    <bean class="no.dusken.common.plugin.security.PluginAuthenticationProviderManager" init-method="init" />
    
    <security:authentication-manager alias="authenticationManager" />
</beans>
